# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a table tennis club management web application for USFTT (US Fontenay TT) that displays player rankings, team results, and statistics. The application consists of a static HTML frontend with JavaScript and a Python backend that fetches data from the FFTT (French Table Tennis Federation) API.

## Architecture

### Frontend Structure (React Migration)
- **Framework**: React 18 with TypeScript
- **Build tool**: Vite
- **Styling**: Tailwind CSS v3.4 (note: upgrade to v4 when stable)
- **Routing**: React Router v6
- **Table library**: TanStack Table v8
- **Icons**: Lucide React
- **Pages**:
  - `/` (HomePage) - Player list with filtering and progression tracking
  - `/classement` (ClassementPage) - Individual ranking/competition results
  - `/equipes` (EquipesPage) - Team results and match statistics
  - `/tests` (TestsPage) - Testing page
- **Mobile-first design** with responsive navigation (desktop top nav, mobile bottom nav)
- **CSV data consumption** - Frontend loads CSV files generated by backend scripts via Papa Parse

### Backend Structure (`backend/` directory)
- **Primary API client**: `fftt.py` - FFTTApiClient class for interacting with FFTT Smartping 2.0 API
- **Data processing scripts**:
  - `usftt_results.py` - Fetches player data, calculates progressions, generates CSV
  - `usftt_results_teams.py` - Fetches team data and match results
- **Data storage**: CSV files for players, licenses, competitors, and team results
- **Python dependencies** managed via Pipfile (requests, pandas, beautifulsoup4, openpyxl)

### Data Flow
1. Backend Python scripts authenticate with FFTT API using environment variables
2. Scripts fetch player/team data and process it (calculate progressions, normalize divisions)
3. Data is saved to CSV files in the backend directory
4. React frontend loads CSV files via custom hooks (`useCsvData`) using Papa Parse
5. TanStack Table renders the data with sorting, filtering, and search capabilities

## Common Development Commands

### Python Backend
```bash
cd backend/
pipenv install          # Install dependencies
pipenv shell            # Activate virtual environment
python fftt.py <endpoint> <params>  # Direct API testing
python usftt_results.py             # Generate player data CSV
python usftt_results_teams.py       # Generate team data CSV
```

### Environment Setup
Required environment variables for FFTT API access:
- `FFTT_APP_ID` - Application ID provided by FFTT
- `FFTT_PASSWORD` - Password for API authentication
- `FFTT_SERIE` - Optional series identifier

### React Frontend Development
```bash
# Development commands (requires Node.js 20+)
npm run dev          # Start dev server (http://localhost:5173/usftt/)
npm run build        # Build for production
npm run preview      # Preview production build
npm run lint         # Run ESLint

# Note: Use Node 20+ via nvm
nvm use 20
```

**Project structure**:
- `src/components/` - React components (layout, ui, shared)
- `src/pages/` - Route pages (HomePage, ClassementPage, EquipesPage, TestsPage)
- `src/hooks/` - Custom hooks for data loading (useCsvData, usePlayerData, etc.)
- `src/types/` - TypeScript type definitions
- `src/utils/` - Utility functions (formatting, class merging)
- `src/constants/` - App constants (CSV paths, routes)
- `public/` - Static assets (images, manifest)
- `archive/` - Original HTML files (for reference)

**Key files**:
- `vite.config.ts` - Build configuration (includes `/usftt/` base path for GitHub Pages)
- `tailwind.config.js` - Tailwind CSS custom theme
- `tsconfig.json` - TypeScript configuration

**Notes**:
- CSV data files must be generated by backend scripts first
- Tailwind CSS v3.4 is used (TODO: upgrade to v4 when stable)
- GitHub Pages deployment via GitHub Actions (see `.github/workflows/deploy.yml`)

### Git Workflow
**Commit Message Convention**: Use semantic commit messages with emoji prefixes

Format: `<emoji> <type>: <description>`

Common types and their emojis:
- ‚ú® `feat:` - New features
- üêõ `fix:` - Bug fixes
- üìù `docs:` - Documentation changes
- üíÑ `style:` - UI/styling changes (CSS, Bootstrap)
- ‚ôªÔ∏è `refactor:` - Code refactoring
- ‚úÖ `test:` - Adding or updating tests
- üîß `chore:` - Maintenance tasks (dependencies, config, etc.)
- üöÄ `perf:` - Performance improvements
- üî• `remove:` - Removing code or files

Examples:
- `‚ú® feat: add team statistics dashboard`
- `üêõ fix: correct progression calculation for November`
- `üìù docs: update API integration instructions`
- `üîß chore: add .vscode to gitignore`

## Key Technical Details

### FFTT API Integration
- Uses HMAC-SHA1 authentication with timestamp-based tokens
- Handles XML responses and converts to Python dictionaries
- Main endpoints: player details, team data, match results, club information
- Club number: "08940073" (hardcoded for USFTT)

### Data Processing Features
- **Progression calculations**: Monthly and phase-based point changes
- **Match counting**: Filters out current month matches for accurate statistics
- **CSV merging**: Updates existing data files while preserving historical data
- **Division normalization**: Standardizes division names (N1, R1, D1, etc.)

### Frontend Features
- **Category filtering** on player lists
- **Mobile responsive** navigation:
  - Desktop: Top navbar (hidden <992px)
  - Mobile: Bottom tab bar with icons (shown <992px)
- **Sortable tables** with TanStack Table (French localization via custom labels)
- **Progression highlighting** (green/red for positive/negative changes via Tailwind custom colors)
- **CSV data loading** from backend files via Papa Parse
- **TypeScript** type safety for data models
- **Component-based architecture** with reusable UI components